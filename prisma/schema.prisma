// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id        String    @id @default(cuid())
  name      String
  email     String?
  phone     String?
  address   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]

  @@index([name])
}

model ProjectType {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]
}

model Project {
  id           String     @id @default(cuid())
  name         String
  clientId     String
  client       Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  projectTypeId String
  projectType  ProjectType @relation(fields: [projectTypeId], references: [id], onDelete: Cascade)
  budget       Float
  hourlyRate   Float?     // Hourly rate for time-based projects
  billingType  String     @default("fixed") // fixed, hourly
  description  String?
  status       String     @default("active") // active, completed, on-hold
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  milestones   Milestone[]
  timeEntries  TimeEntry[]

  @@index([clientId])
  @@index([projectTypeId])
}

model Milestone {
  id          String    @id @default(cuid())
  name        String
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  amount      Float
  dueDate     DateTime
  status      String    @default("pending") // pending, paid, overdue
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  payments    Payment[]

  @@index([projectId])
  @@index([dueDate])
  @@index([status])
}

model Payment {
  id          String    @id @default(cuid())
  milestoneId String
  milestone   Milestone @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  amount      Float
  paymentDate DateTime  @default(now())
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([milestoneId])
  @@index([paymentDate])
}

model Assignee {
  id          String      @id @default(cuid())
  name        String
  email       String?
  phone       String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  timeEntries TimeEntry[]

  @@index([name])
}

model TimeEntry {
  id          String    @id @default(cuid())
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assigneeId  String
  assignee    Assignee  @relation(fields: [assigneeId], references: [id], onDelete: Cascade)
  date        DateTime
  hours       Float
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([projectId])
  @@index([assigneeId])
  @@index([date])
}


